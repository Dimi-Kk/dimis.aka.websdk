<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pushwoosh Debug</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1e1e1e;
      color: #e0e0e0;
      padding: 20px;
    }
    button {
      margin: 10px 0;
      padding: 10px 15px;
      border: none;
      background: #00d4ff;
      color: #000;
      cursor: pointer;
      border-radius: 6px;
      font-weight: bold;
    }
    pre {
      background: #2c2c2c;
      padding: 10px;
      border-radius: 6px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>üì¨ Pushwoosh Debug Tool</h1>
  <p>Use buttons below to test subscription status, tokens, and Pushwoosh integration.</p>

  <button onclick="checkStatus()">Check Subscription Status</button>
  <button onclick="subscribe()">Subscribe</button>
  <button onclick="unsubscribe()">Unsubscribe</button>
  <pre id="output">Logs will appear here...</pre>

  <script src="https://cdn.pushwoosh.com/webpush/v3/pushwoosh-web-notifications.js" async></script>

  <script>
    const log = (text) => {
      const out = document.getElementById('output');
      out.textContent += '\n' + text;
    };

    const clear = () => {
      document.getElementById('output').textContent = '';
    };

    Pushwoosh = Pushwoosh || [];
    Pushwoosh.push(['init', {
      applicationCode: '6A132-8C2C5',
      autoSubscribe: false,
      logLevel: 'debug',
      userId: 'dimon test'
    }]);

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/dimis.aka.websdk/pushwoosh-service-worker.js')
        .then(reg => log('‚úÖ Service worker registered: ' + reg.scope))
        .catch(err => log('‚ùå Service worker registration failed: ' + err));
    }

    function checkStatus() {
      clear();
      Pushwoosh.push(api => {
        api.getSubscription().then(sub => {
          if (sub && sub.deviceToken) {
            log('‚úÖ Subscribed! Device token: ' + sub.deviceToken);
            log(JSON.stringify(sub, null, 2));
          } else {
            log('üö´ Not subscribed.');
            log(JSON.stringify(sub, null, 2));
          }
        }).catch(err => log('‚ùå Error getting subscription: ' + err));
      });
    }

    function subscribe() {
      clear();
      Pushwoosh.push(api => {
        api.subscribe().then(res => {
          log('üì¨ Subscribed successfully: ' + JSON.stringify(res));
          return api.getSubscription();
        }).then(sub => {
          log('üì¶ Subscription: ' + JSON.stringify(sub, null, 2));
        }).catch(err => log('‚ùå Subscription error: ' + err));
      });
    }

    function unsubscribe() {
      clear();
      Pushwoosh.push(api => {
        api.unsubscribe().then(() => {
          log('üîÅ Unsubscribed successfully.');
        }).catch(err => log('‚ùå Unsubscribe error: ' + err));
      });
    }
  </script>
</body>
</html>
